apiVersion: apps/v1
kind: Deployment
metadata:
  name: manual-log-sender
  namespace: observability
  labels:
    app: manual-log-sender
spec:
  replicas: 1
  selector:
    matchLabels:
      app: manual-log-sender
  template:
    metadata:
      labels:
        app: manual-log-sender
    spec:
      containers:
      - name: sender
        image: curlimages/curl:latest
        command: ["/bin/sh"]
        args:
        - -c
        - |
          while true; do
            echo "Sending test log to Loki..."
            curl -X POST -H "Content-Type: application/json" \
              -d "{\"streams\":[{\"stream\":{\"namespace\":\"arc-omega\",\"app\":\"omega-monitor\"},\"values\":[[\"$(date +%s)000000000\",\"{\\\"reason_code\\\":\\\"MANUAL_TEST\\\",\\\"note\\\":\\\"Manual log sender test $(date)\\\"}\"]]}]}" \
              http://10.100.164.48:3100/loki/api/v1/push
            sleep 30
          done
