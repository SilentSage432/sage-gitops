apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: APPNAME-egress
  namespace: ARCNS
spec:
  endpointSelector:
    matchLabels:
      app: APPNAME
  egress:
    # DNS to kube-dns (cluster sovereign)
    - toEndpoints:
        - matchLabels: { "k8s:io.kubernetes.pod.namespace": "kube-system", "k8s:k8s-app": "kube-dns" }
      toPorts:
        - ports:
            - { port: "53", protocol: UDP }
            - { port: "53", protocol: TCP }
    # Chi leaf connection
    - toServices:
        - k8sService:
            namespace: arc-chi
            serviceName: chi-bus
      toPorts:
        - ports:
            - { port: "7422", protocol: TCP }
